<script src="https://unpkg.com/html5-qrcode"></script>

<script>
    // ... (Keep your existing log/goals logic at the top)

    // NEW TURBO-SCANNER CONFIG
    const scanner = new Html5QrcodeScanner("reader", { 
        fps: 30, // Increased from 20 for smoother detection
        qrbox: (viewfinderWidth, viewfinderHeight) => {
            // Creates a dynamic scanning window optimized for rectangular barcodes
            return { width: viewfinderWidth * 0.8, height: 150 }; 
        },
        aspectRatio: 1.0,
        experimentalFeatures: {
            useBarCodeDetectorIfSupported: true // Uses the phone's native hardware if available
        },
        rememberLastUsedCamera: true,
        showTorchButtonIfSupported: true, // Adds a flashlight button for dim kitchens!
        videoConstraints: {
            facingMode: "environment",
            focusMode: "continuous",
            width: { ideal: 1920 }, // Higher resolution for sharper lines
            height: { ideal: 1080 }
        }
    });

    // This specifically tells the engine to look for UK-standard barcodes first
    const formatsToSupport = [
        Html5QrcodeSupportedFormats.EAN_13,
        Html5QrcodeSupportedFormats.EAN_8,
        Html5QrcodeSupportedFormats.CODE_128
    ];

    scanner.render(onScanSuccess, onScanFailure);

    // ... (Keep your existing onScanSuccess and fetch logic)
    
    // Tiny addition to stop "error spam" in the console
    function onScanFailure(error) { /* Ignore standard scan misses to save battery */ }
</script>
